<project name="BIMserver Demo Server">
	<taskdef name="deploy" classname="org.apache.catalina.ant.DeployTask" classpath="antlibs/catalina-ant.jar" />
	<taskdef name="list" classname="org.apache.catalina.ant.ListTask" classpath="antlibs/catalina-ant.jar"/>
	<taskdef name="reload" classname="org.apache.catalina.ant.ReloadTask" classpath="antlibs/catalina-ant.jar"/>
	<taskdef name="resources" classname="org.apache.catalina.ant.ResourcesTask" classpath="antlibs/catalina-ant.jar"/>
	<taskdef name="roles" classname="org.apache.catalina.ant.RolesTask" classpath="antlibs/catalina-ant.jar"/>
	<taskdef name="start" classname="org.apache.catalina.ant.StartTask" classpath="antlibs/catalina-ant.jar"/>
	<taskdef name="stop" classname="org.apache.catalina.ant.StopTask" classpath="antlibs/catalina-ant.jar"/>
	<taskdef name="undeploy" classname="org.apache.catalina.ant.UndeployTask" classpath="antlibs/catalina-ant.jar"/>
	<target name="deploydemowar">
		<property name="target" value="demo" />

		<tstamp>
			<format property="builddate" pattern="yyyy-MM-dd" />
		</tstamp>

		<property name="majorversion" value="1"/>
		<property name="minorversion" value="2"/>
		<property name="revisionversion" value="0"/>
		<property name="revisiondate" value="${builddate}"/>
		<property name="version" value="${majorversion}.${minorversion}.${revisionversion}-${builddate}"/>

		<ant antfile="bimserver.build.xml" target="Build War"></ant>

		<copyfile dest="builds/BuildWar/META-INF/context.xml" src="context.xml"/>
		<jar destfile="builds/bimserver-${version}.war">
			<fileset dir="builds/BuildWar">
				<exclude name="*.svn" />
			</fileset>
		</jar>
		<delete dir="builds/BuildWar" failonerror="false" />
		
		<undeploy url="${tomcat_manager_url}" username="${tomcat_username}" password="${tomcat_password}" path="/" failonerror="false" />
		<deploy url="${tomcat_manager_url}" username="${tomcat_username}" password="${tomcat_password}" path="/" war="file:builds/bimserver-${version}.war" />
	</target>
</project>