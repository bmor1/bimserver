#summary How to install the BIMserver on a freshly installed Ubuntu 10.10 Server
#labels Deploy,Developerguide,ubuntu,cloud

= Introduction =

This guide is used to install a BIMserver on a cloud based server. Root rights are assumed, when running as a normal user, prepend "sudo " to each command.

Paths can be changed to your liking of course.

= Commands =

|| *Command* || *Description* ||
||passwd||Change your password||
||apt-get update||Update the package index||
||apt-get upgrade||Upgrade installed packages||
||apt-get install default-jre-headless tomcat6||Install JRE 6 and Tomcat 6||
||ntpdate ntp2.xs4all.nl||Update the local time||
||dpkg-reconfigure tzdata||Select timezone||
||nano /etc/tomcat6/server.xml||Change the port attribute in the Connector tag to the desired port (please see: "Running op ports below 1024" ||
||nano /var/lib/tomcat6/conf/policy.d/04webapps.policy||Change to:{{{grant { permission java.security.AllPermission;};}}}||
||rm -R /var/lib/tomcat6/webapps/ROOT||Remove the default ROOT application||
||wget http://bimserver.googlecode.com/files/bimserver-1.0.war -O /var/lib/tomcat6/webapps/ROOT.war||Download the latest version of the BIMserver, and install as ROOT application||
||mkdir /var/databases||Create a database directory||
||chown -R tomcat6 /var/databases||Give the tomcat user access to the database directory||
||chown -R tomcat6 /usr/share/tomcat6/webapps||Give Tomcat rights on the webapps directory (this should have already been done||

Eidt /etc/default/tomcat6 (with "nano" for example), change the line with "JAVA_OPTS" to: JAVA_OPTS="-Djava.awt.headless=true -Xmx12G -Xss4096k"

The 12G parameter indicates 12GB of heap memory, please adjust to your server (always keep a few hundred megabytes free for your OS).

You should set the settings first ("Edit settings").

Restart Tomcat: /etc/init.d/tomcat6 restart

= Edit settings =

Edit the file: /var/lib/tomcat6/webapps/ROOT/WEB-INF/settings.xml

Change the 
{{{
<databaseLocation>
}}} value to 
{{{
/var/databases/bimserver
}}}

Edit the file: /var/lib/tomcat6/webapps/ROOT/WEB-INF/classes/log4j.xml

Change 
{{{
<param name="File" value="bimserver.log" />
}}}
 to
{{{
<param name="File" value="/var/log/tomcat6/bimserver.log" />
}}}

= Using the Tomcat Manager =

(Copied from: [https://help.ubuntu.com/10.10/serverguide/C/tomcat.html])
== Tomcat administration webapps ==

The tomcat6-admin package contains two webapps that can be used to administer the Tomcat server using a web interface. You can install them by entering the following command in the terminal prompt:

sudo apt-get install tomcat6-admin
The first one is the manager webapp, which you can access by default at http://yourserver:8080/manager/html. It is primarily used to get server status and restart webapps.

Access to the manager application is protected by default: you need to define a user with the role "manager" in /etc/tomcat6/tomcat-users.xml before you can access it.

= Installing an STMP server =

{{{
apt-get install postfix
}}}

Select "Internet server", use a real domain name that is pointing to your server's IP address.

= Running op ports below 1024 =

The tomcat user has no rights to bind to ports below 1024, to make the server available on port 80 (the default HTTP port), you can use iptables (you might have to install the package "iptables"):

iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080