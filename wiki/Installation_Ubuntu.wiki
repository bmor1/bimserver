#summary How to install the BIMserver on a freshly installed Ubuntu 12.04.2 LTS Server
#labels Deploy,Developerguide,ubuntu,cloud

Note: These instructions are for the 1.2 final release.

The machine this was tested on was a Ubuntu Server 12.04.2 LTS Amazon EC2 server (Ubuntu Cloud Guest AMI ID ami-d0f89fb9 (x86_64)) on an m1.xlarge machine.

= Introduction =

This guide is used to install a BIMserver on a cloud based server. Root rights are assumed. When running as a normal user, prepend "sudo " to each command (or start your session with sudo -i).

Paths can be changed to your liking of course.

= Commands =

|| *Command* || *Description* ||
||apt-get update||Update the package index||
||apt-get upgrade||Upgrade installed packages||
||apt-get install openjdk-7-jre-headless tomcat7||Install JRE 7 and Tomcat 7||
||ntpdate ntp2.xs4all.nl||Update the local time||
||dpkg-reconfigure tzdata||Select timezone||
||nano /etc/tomcat6/server.xml||Change the port attribute in the Connector tag to the desired port (please see: "Running op ports below 1024" ||
||nano /var/lib/tomcat6/conf/policy.d/04webapps.policy||Change to:{{{grant { permission java.security.AllPermission;};}}}||
||rm -R /var/lib/tomcat6/webapps/ROOT||Remove the default ROOT application||
||wget http://bimserver.googlecode.com/files/bimserver-1.0.war -O /var/lib/tomcat6/webapps/ROOT.war||Download the latest version of the BIMserver, and install as ROOT application||
||mkdir /var/databases||Create a database directory||
||chown -R tomcat6 /var/databases||Give the tomcat user access to the database directory||
||chown -R tomcat6 /usr/share/tomcat6/webapps||Give Tomcat rights on the webapps directory (this should have already been done||

Edit /etc/default/tomcat7 (with "nano" for example), change the line with "JAVA_OPTS" to: JAVA_OPTS="-Djava.awt.headless=true -Xmx12G -Xss4096k"

The 12G parameter indicates 12GB of heap memory, please adjust to your server (always keep a few hundred megabytes free for your OS and other apps).

Restart Tomcat: service tomcat7 restart

= Using the Tomcat Manager =

(Copied from: [https://help.ubuntu.com/10.10/serverguide/C/tomcat.html])
== Tomcat administration webapps ==

The tomcat6-admin package contains two webapps that can be used to administer the Tomcat server using a web interface. You can install them by entering the following command in the terminal prompt:

{{{
sudo apt-get install tomcat6-admin
}}}
The first one is the manager webapp, which you can access by default at http://yourserver:8080/manager/html. It is primarily used to get server status and restart webapps.

Access to the manager application is protected by default: you need to define a user with the role "manager" in /etc/tomcat6/tomcat-users.xml before you can access it.

= Installing an STMP server =

{{{
apt-get install postfix
}}}

Select "Internet server", use a real domain name that is pointing to your server's IP address.

= Running op ports below 1024 =

The tomcat user has no rights to bind to ports below 1024, to make the server available on port 80 (the default HTTP port), you can use iptables (you might have to install the package "iptables"):

{{{
iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080
}}}

to store these settings:
{{{
iptables-save
}}}

= Tmp folder =

Sometimes the BIMserver cannot create the tmp folder used by JNA, this folder is usually created in /var/lib/tomcat6/tmp, if you see errors about this in the log, try the following:

{{{
mkdir /var/lib/tomcat6/tmp
chown -R tomcat6 /var/lib/tomcat6/tmp
}}}