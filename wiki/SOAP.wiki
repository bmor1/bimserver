#summary Basic explanation of using the BIMserver SOAP interface

= Introduction =

External applications can interact with the BIMserver via SOAP (and [Interfaces other protocols]). For SOAP you need a WSDL file which describes all the methods/objects that are available. This BIMserver WSDL file can be found by running the BIMserver, logging in as an administrator via the webbased user interface, and going to Info | Web Services, see below.

http://bimserver.googlecode.com/svn/wiki/images/wsdl.png

= SOAP Stack =

To use SOAP you will need to have a "SOAP Stack" for your programming language. A SOAP Stack is just a library containing all the logic for the SOAP protocol. For most programming languages there are multiple, so it's up to you to choose one.

Your SOAP Stack is probably able to generate a bunch of code for your programming language based on a WSDL file/url, this is not required but makes your life a lot easier.

= BIMserver SOAP =

The BIMserver SOAP server is running on the same address/port as your web user interface, in most cases this will be 8082 (for a runnable JAR), 8080 for tomcat.

The WSDL file will give you the exact URL for the SOAP service, but it is always in the following format: http://[address of server]:[port of server]/soap. To get the WSDL file, append "?wsdl" to the URL.

= Authentication =

The newest version of the BIMserver can use two kinds of session management to remember the user credentials, versions before 1.0 were using a token object as the first parameter of every call which was not optimal.

== HTTP Session Based ==

Make sure to enable session management in your client, otherwise the server won't be able to remember who you are and you will get this message:
{{{
"Authentication required for this call"
}}}

For Apache CXF, you can enable sessions this way:
{{{
((javax.xml.ws.BindingProvider)port).getRequestContext().put(BindingProvider.SESSION_MAINTAIN_PROPERTY, true);
}}}

For .Net based clients, this can be done this way:
{{{
client = new BiMserver.ServiceInterfaceService();
client.CookieContainer = new System.Net.CookieContainer();
}}}

== SOAP Header Based ==

Some clients won't be able to alter the HTTP Headers, so an alternative is to use the SOAP Header. The BIMserver supports both ways without any server side configuration.

First make a call to the BIMserver "getCurrentToken", this will return a "Token" object which you will have to include in subsequent calls. The SOAP message will have to look like this:

{{{
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
	<soap:Header>
		<ns2:token xmlns:ns2="uri:org.bimserver">
			<expires>1318847448012</expires>
			<tokenString>70230BC83C052A3D1312FC516F9E3F5E</tokenString>
		</ns2:token>
	</soap:Header>
	<soap:Body>
		<ns2:getAllUsers xmlns:ns2="http://shared.bimserver.org/"
			xmlns:ns3="uri:org.bimserver" />
	</soap:Body>
</soap:Envelope>
}}}

To enable this kind of functionality in Apache CXF
{{{
	Token token = serviceInterface.getCurrentToken();
	List<Header> headers = new ArrayList<Header>();
	Header sessionHeader = new Header(new QName("uri:org.bimserver", "token"), token, new JAXBDataBinding(Token.class));
	headers.add(sessionHeader);
	((BindingProvider) serviceInterface).getRequestContext().put(Header.HEADER_LIST, headers);
}}}
= GeneratedClient =
From version 1.1, there is a "GeneratedSoapClient" project in SVN. This project contains generated source code based on Apache CXF and the latest BIMserver "ServiceInterface". It's just a convenience project.